{"ast":null,"code":"import { COMPLETE_ONBOARDING, STORE_POSTS, LOGIN_SUCCESS, INVALID_LOGIN, LOGIN_NETWORK_ERROR, LOGOUT, UPDATE_DOWNLOAD_URL, NEW_MESSAGE, CONNECTED, STORE_USERS, ADD_REPLY, UPDATE_REACTS, ADD_POST_PAGE, VIEW_POST, STORE_ONLINE_USERS } from \"./actionConstants\";\nimport firebase from \"../data/fbConfig\";\nimport { joinChat, sendMessage } from \"../client\";\nconst database = firebase.firestore();\nexport const loginSuccess = user => ({\n  type: LOGIN_SUCCESS,\n  payload: {\n    user: user,\n    completeOnboarding: user.isNewUser\n  }\n});\nexport const loginFail = () => ({\n  type: INVALID_LOGIN\n});\nexport const loginNetworkError = () => ({\n  type: LOGIN_NETWORK_ERROR\n});\nexport const logout = () => ({\n  type: LOGOUT\n});\nexport const addPostPage = () => ({\n  type: ADD_POST_PAGE\n});\nexport const viewPost = () => ({\n  type: VIEW_POST\n});\nexport const storePosts = posts => ({\n  type: STORE_POSTS,\n  payload: {\n    posts: posts\n  }\n});\nexport const getPosts = () => {\n  return dispatch => {\n    database.collection(\"posts\").get().then(querySnapshot => {\n      if (querySnapshot.size > 0) {\n        const posts = {};\n        querySnapshot.forEach(doc => {\n          posts[doc.id] = {\n            caption: doc.data().caption,\n            datePosted: doc.data().datePosted,\n            pictureUrl: doc.data().pictureUrl,\n            reacts: doc.data().reacts,\n            replies: doc.data().replies,\n            tags: doc.data().tags,\n            userId: doc.data().userId,\n            username: doc.data().username\n          };\n        });\n        dispatch(storePosts(posts));\n      } else {\n        console.log(\"No posts available\");\n      }\n    }).catch(error => {\n      console.log(\"Error\");\n    });\n  };\n};\nexport const storeUsers = users => {\n  return {\n    type: STORE_USERS,\n    payload: {\n      users: users\n    }\n  };\n};\nexport const storeUsersOnline = users => {\n  return {\n    type: STORE_ONLINE_USERS,\n    payload: {\n      onlineUsers: users\n    }\n  };\n};\n\nconst updateReply = (postId, reply) => ({\n  type: ADD_REPLY,\n  payload: {\n    postId: postId,\n    reply: reply\n  }\n});\n\nconst updateReacts = (postId, reacts) => ({\n  type: UPDATE_REACTS,\n  payload: {\n    postId: postId,\n    reacts: reacts\n  }\n});\n\nconst updateDownloadUrl = url => ({\n  type: UPDATE_DOWNLOAD_URL,\n  payload: {\n    url: url\n  }\n});\n\nexport const getUsers = () => {\n  return dispatch => {\n    database.collection(\"users\").get().then(querySnapshot => {\n      if (querySnapshot.size > 0) {\n        const userDatabase = {};\n        querySnapshot.forEach(doc => {\n          userDatabase[doc.id] = {\n            username: doc.data().username,\n            password: doc.data().password,\n            isNewUser: doc.data().isNewUser,\n            isPublic: doc.data().isPublic,\n            profilePicture: doc.data().profilePicture,\n            friendsList: doc.data().friendsList,\n            userId: doc.id\n          };\n        });\n        dispatch(storeUsers(userDatabase));\n      } else {\n        console.log(\"No users available\");\n      }\n    }).catch(error => {\n      console.log(\"Error in loading users\");\n    });\n  };\n};\n\nconst updateOnboarding = complete => ({\n  type: COMPLETE_ONBOARDING,\n  payload: {\n    user: {\n      isNewUser: complete\n    }\n  }\n});\n\nexport const completeOnboarding = (complete, userId) => {\n  return dispatch => {\n    database.collection(\"users\").doc(userId).update({\n      isNewUser: complete\n    }).then(() => {\n      dispatch(updateOnboarding(complete));\n    }).catch(error => {\n      console.log(\"Could not update user onboarding status:\", error);\n    });\n  };\n};\nexport const addReply = (reply, postId) => {\n  return dispatch => {\n    database.collection(\"posts\").doc(postId).update({\n      replies: firebase.firestore.FieldValue.arrayUnion(reply)\n    }).then(() => {\n      dispatch(updateReply(postId, reply));\n    }).catch(error => {\n      console.log(\"Could not add the reply.\", error);\n    });\n  };\n};\nexport const addReacts = (reacts, postId) => {\n  return dispatch => {\n    database.collection(\"posts\").doc(postId).update({\n      reacts: reacts\n    }).then(() => {\n      dispatch(updateReacts(postId, reacts));\n    }).catch(error => {\n      console.log(\"Could not add the reply.\", error);\n    });\n  };\n};\n\nconst store = async (postImagesRef, pictureUrl) => {\n  console.log(\"awaiting upload\");\n  await postImagesRef.put(pictureUrl);\n  let url = await postImagesRef.getDownloadURL();\n  url.then(l => {\n    console.log(\"l: \", l);\n    return l;\n  });\n  return url; //console.log(\"image ref inside: \", postImagesRef)\n};\n/* const download = async(postImagesRef) => {\n  console.log(\"awaiting download\")\n  let url = await postImagesRef.getDownloadURL()\n  url.then((l) => {return l})\n  //return url;\n} */\n\n\nexport const uploadPic = pictureUrl => {\n  console.log(\"upload pic action HERE\");\n  var storage = firebase.storage();\n  var storageRef = storage.ref();\n  var imagesRef = storageRef.child('images');\n  var postImagesRef = imagesRef.child(pictureUrl.name);\n  console.log(\"image ref: \", postImagesRef);\n  let url = store(postImagesRef, pictureUrl);\n  console.log(\"wait over\");\n  return dispatch => {\n    //let url = download(postImagesRef)\n    console.log('download over url: ', url);\n    dispatch(updateDownloadUrl(url));\n  };\n};\nlet d = new Date();\nexport const addPost = (caption, pictureUrl, tags, username) => {\n  return dispatch => {\n    console.log(\"pic url: \", pictureUrl);\n    database.collection(\"posts\").add({\n      caption: caption,\n      datePosted: `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()}`,\n      pictureUrl: pictureUrl,\n      tags: tags,\n      username: username,\n      reacts: {\n        heart: 0,\n        laugh: 0,\n        cry: 0,\n        angry: 0\n      },\n      replies: []\n    }).then(() => {\n      console.log(\"Added new post\");\n    }).catch(error => {\n      console.log(\"Could not add the new post: \", error);\n    });\n  };\n};\nexport const connectToChat = username => {\n  console.log(\"here\");\n  return dispatch => joinChat(username);\n}; // Replaces the direct call to sendMessage in Form\n\nexport const sendToChat = msg => {\n  return dispatch => sendMessage(msg);\n};\nexport const isConnected = () => ({\n  type: CONNECTED\n});\nexport const newMessage = messages => ({\n  type: NEW_MESSAGE,\n  payload: {\n    messages\n  }\n});","map":{"version":3,"sources":["/Users/shebthebat/Documents/NEU/Sem 5/CS 7580/neuGram-webApp/src/redux/actions.js"],"names":["COMPLETE_ONBOARDING","STORE_POSTS","LOGIN_SUCCESS","INVALID_LOGIN","LOGIN_NETWORK_ERROR","LOGOUT","UPDATE_DOWNLOAD_URL","NEW_MESSAGE","CONNECTED","STORE_USERS","ADD_REPLY","UPDATE_REACTS","ADD_POST_PAGE","VIEW_POST","STORE_ONLINE_USERS","firebase","joinChat","sendMessage","database","firestore","loginSuccess","user","type","payload","completeOnboarding","isNewUser","loginFail","loginNetworkError","logout","addPostPage","viewPost","storePosts","posts","getPosts","dispatch","collection","get","then","querySnapshot","size","forEach","doc","id","caption","data","datePosted","pictureUrl","reacts","replies","tags","userId","username","console","log","catch","error","storeUsers","users","storeUsersOnline","onlineUsers","updateReply","postId","reply","updateReacts","updateDownloadUrl","url","getUsers","userDatabase","password","isPublic","profilePicture","friendsList","updateOnboarding","complete","update","addReply","FieldValue","arrayUnion","addReacts","store","postImagesRef","put","getDownloadURL","l","uploadPic","storage","storageRef","ref","imagesRef","child","name","d","Date","addPost","add","getFullYear","getMonth","getDate","heart","laugh","cry","angry","connectToChat","sendToChat","msg","isConnected","newMessage","messages"],"mappings":"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","sourcesContent":["import { COMPLETE_ONBOARDING, STORE_POSTS, LOGIN_SUCCESS, INVALID_LOGIN, \n  LOGIN_NETWORK_ERROR, LOGOUT, UPDATE_DOWNLOAD_URL, NEW_MESSAGE, CONNECTED, STORE_USERS, ADD_REPLY, \n  UPDATE_REACTS, ADD_POST_PAGE, VIEW_POST, STORE_ONLINE_USERS } from \"./actionConstants\";\n\nimport firebase from \"../data/fbConfig\";\n\nimport { joinChat, sendMessage } from \"../client\";\n\nconst database = firebase.firestore();\n\nexport const loginSuccess = user => ({\n    type: LOGIN_SUCCESS,\n    payload: {\n        user: user,\n        completeOnboarding: user.isNewUser\n    }\n});\n\nexport const loginFail = () => ({\n    type: INVALID_LOGIN\n});\n\nexport const loginNetworkError = () => ({\n    type: LOGIN_NETWORK_ERROR\n});\n\nexport const logout = () => ({\n    type: LOGOUT\n});\n\nexport const addPostPage = () => ({\n  type: ADD_POST_PAGE\n})\n\nexport const viewPost = () => ({\n  type: VIEW_POST\n})\n\nexport const storePosts = (posts) => ({\n    type: STORE_POSTS,\n    payload: {\n        posts: posts\n    }\n})\n\nexport const getPosts = () => {\n    return dispatch => {\n      \n      database.collection(\"posts\")\n        .get()\n        .then((querySnapshot) => {\n          if (querySnapshot.size > 0) {\n            const posts = {};\n            querySnapshot.forEach(doc => {\n              posts[doc.id] = {\n                caption:doc.data().caption,\n                datePosted:doc.data().datePosted,\n                pictureUrl:doc.data().pictureUrl,\n                reacts:doc.data().reacts,\n                replies:doc.data().replies,\n                tags:doc.data().tags,\n                userId:doc.data().userId,\n                username:doc.data().username\n              }\n            })\n            dispatch(storePosts(posts));\n          }\n          else {\n            console.log(\"No posts available\") \n          }\n        })\n        .catch(error => {\n          console.log(\"Error\")\n        });\n    }\n  };\n\nexport const storeUsers = (users) => {\n  return {\n    type: STORE_USERS,\n    payload: {\n        users: users\n    }\n  }\n};\n\nexport const storeUsersOnline = (users) => {\n  return {\n    type: STORE_ONLINE_USERS,\n    payload: {\n        onlineUsers: users\n    }\n  }\n}\n\nconst updateReply = (postId, reply) => ({\n  type: ADD_REPLY,\n  payload: {\n      postId: postId,\n      reply: reply\n  }\n})\n\nconst updateReacts = (postId, reacts) => ({\n  type: UPDATE_REACTS,\n  payload: {\n      postId: postId,\n      reacts: reacts\n  }\n})\n\nconst updateDownloadUrl = (url) => ({\n  type: UPDATE_DOWNLOAD_URL,\n  payload: {\n    url: url\n  }\n})\n\nexport const getUsers = () => {\n  return dispatch => {\n    \n    database.collection(\"users\")\n      .get()\n      .then((querySnapshot) => {\n        if (querySnapshot.size > 0) {\n          const userDatabase = {};\n          querySnapshot.forEach(doc => {\n            userDatabase[doc.id] = {\n              username:doc.data().username,\n              password:doc.data().password,\n              isNewUser:doc.data().isNewUser,\n              isPublic:doc.data().isPublic,\n              profilePicture:doc.data().profilePicture,\n              friendsList:doc.data().friendsList,\n              userId: doc.id\n            }\n          })\n          dispatch(storeUsers(userDatabase));\n        }\n        else {\n          console.log(\"No users available\") \n        }\n      })\n      .catch(error => {\n        console.log(\"Error in loading users\")\n      });\n      \n}};\n\nconst updateOnboarding = (complete) => ({\n  type: COMPLETE_ONBOARDING,\n  payload: {\n    user: {\n      isNewUser: complete\n    }\n  }\n})\n\nexport const completeOnboarding = (complete, userId) => {\n  return dispatch => {\n    database.collection(\"users\").doc(userId)\n      .update({\n        isNewUser: complete\n      })\n      .then(() => {\n        dispatch(updateOnboarding(complete));\n      })\n      .catch(error => {\n        console.log(\"Could not update user onboarding status:\", error);\n      })\n  }\n}\n\nexport const addReply = (reply, postId) => {\n  return dispatch => {\n    database.collection(\"posts\").doc(postId)\n      .update({\n        replies: firebase.firestore.FieldValue.arrayUnion(reply)\n      })\n      .then(() => {\n          dispatch(updateReply(postId, reply));\n      })\n      .catch(error => {\n        console.log(\"Could not add the reply.\",error);\n      })\n  }\n}\n\nexport const addReacts = (reacts, postId) => {\n  return dispatch => {\n    database.collection(\"posts\").doc(postId)\n      .update({\n        reacts: reacts\n      })\n      .then(() => {\n          dispatch(updateReacts(postId, reacts));\n      })\n      .catch(error => {\n        console.log(\"Could not add the reply.\",error);\n      })\n  }\n}\n\nconst store = async(postImagesRef, pictureUrl) => {\n  console.log(\"awaiting upload\")\n  await postImagesRef.put(pictureUrl)\n  let url = await postImagesRef.getDownloadURL()\n  url.then((l) => {\n    console.log(\"l: \", l)\n    return l\n  })\n  return url;\n  //console.log(\"image ref inside: \", postImagesRef)\n}\n\n/* const download = async(postImagesRef) => {\n  console.log(\"awaiting download\")\n  let url = await postImagesRef.getDownloadURL()\n  url.then((l) => {return l})\n  //return url;\n} */\n\nexport const uploadPic = (pictureUrl) => {\n\n  console.log(\"upload pic action HERE\")\n  var storage = firebase.storage();\n  var storageRef = storage.ref();\n  var imagesRef = storageRef.child('images');\n  var postImagesRef = imagesRef.child(pictureUrl.name);\n  console.log(\"image ref: \", postImagesRef)\n  let url = store(postImagesRef, pictureUrl)\n  console.log(\"wait over\")\n\n  return dispatch => {\n\n    //let url = download(postImagesRef)\n    console.log('download over url: ', url)\n        dispatch(updateDownloadUrl(url));\n    \n  }\n\n  \n}\n\n\n\nlet d = new Date();\nexport const addPost = (caption, pictureUrl, tags, username) => {\n  \n\n  return dispatch => {\n    console.log(\"pic url: \", pictureUrl)\n    database.collection(\"posts\")\n      .add({\n        caption: caption,\n        datePosted: `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`,\n        pictureUrl: pictureUrl,\n        tags: tags,\n        username: username,\n        reacts: {heart:0, laugh:0, cry:0, angry:0},\n        replies: [],\n      })\n      .then(() => {\n          console.log(\"Added new post\")\n      })\n      .catch(error => {\n        console.log(\"Could not add the new post: \", error);\n\n      })\n  }\n}\n\nexport const connectToChat = username => {\n    console.log(\"here\");\n    return dispatch => joinChat(username);\n    \n}\n\n// Replaces the direct call to sendMessage in Form\nexport const sendToChat = msg =>  {\n    return dispatch => sendMessage(msg);\n}\n\nexport const isConnected = () => ({type: CONNECTED})\n\nexport const newMessage = messages => ({\n    type: NEW_MESSAGE,\n    payload: {\n        messages\n    }\n})"]},"metadata":{},"sourceType":"module"}