{"ast":null,"code":"import { COMPLETE_ONBOARDING, STORE_POSTS, LOGIN_SUCCESS, INVALID_LOGIN, LOGIN_NETWORK_ERROR, LOGOUT, NEW_MESSAGE, CONNECTED, STORE_USERS, ADD_REPLY, UPDATE_REACTS, ADD_POST_PAGE, VIEW_POST, STORE_ONLINE_USERS } from \"./actionConstants\";\nimport firebase from \"../data/fbConfig\";\nimport { joinChat, sendMessage } from \"../client\";\nconst database = firebase.firestore();\nexport const loginSuccess = user => ({\n  type: LOGIN_SUCCESS,\n  payload: {\n    user: user,\n    completeOnboarding: user.isNewUser\n  }\n});\nexport const loginFail = () => ({\n  type: INVALID_LOGIN\n});\nexport const loginNetworkError = () => ({\n  type: LOGIN_NETWORK_ERROR\n});\nexport const logout = () => ({\n  type: LOGOUT\n});\nexport const addPostPage = () => ({\n  type: ADD_POST_PAGE\n});\nexport const viewPost = () => ({\n  type: VIEW_POST\n});\nexport const storePosts = posts => ({\n  type: STORE_POSTS,\n  payload: {\n    posts: posts\n  }\n});\nexport const getPosts = () => {\n  return dispatch => {\n    database.collection(\"posts\").get().then(querySnapshot => {\n      if (querySnapshot.size > 0) {\n        const posts = {};\n        querySnapshot.forEach(doc => {\n          posts[doc.id] = {\n            caption: doc.data().caption,\n            datePosted: doc.data().datePosted,\n            pictureUrl: doc.data().pictureUrl,\n            reacts: doc.data().reacts,\n            replies: doc.data().replies,\n            tags: doc.data().tags,\n            userId: doc.data().userId,\n            username: doc.data().username\n          };\n        });\n        dispatch(storePosts(posts));\n      } else {\n        console.log(\"No posts available\");\n      }\n    }).catch(error => {\n      console.log(\"Error\");\n    });\n  };\n};\nexport const storeUsers = users => {\n  return {\n    type: STORE_USERS,\n    payload: {\n      users: users\n    }\n  };\n};\nexport const storeUsersOnline = users => {\n  return {\n    type: STORE_ONLINE_USERS,\n    payload: {\n      onlineUsers: users\n    }\n  };\n};\n\nconst updateReply = (postId, reply) => ({\n  type: ADD_REPLY,\n  payload: {\n    postId: postId,\n    reply: reply\n  }\n});\n\nconst updateReacts = (postId, reacts) => ({\n  type: UPDATE_REACTS,\n  payload: {\n    postId: postId,\n    reacts: reacts\n  }\n});\n\nexport const getUsers = () => {\n  return dispatch => {\n    const database = firebase.firestore();\n    database.collection(\"users\").get().then(querySnapshot => {\n      if (querySnapshot.size > 0) {\n        const userDatabase = {};\n        querySnapshot.forEach(doc => {\n          userDatabase[doc.id] = {\n            username: doc.data().username,\n            password: doc.data().password,\n            isNewUser: doc.data().isNewUser,\n            isPublic: doc.data().isPublic,\n            profilePicture: doc.data().profilePicture,\n            friendsList: doc.data().friendsList,\n            userId: doc.id\n          };\n        });\n        dispatch(storeUsers(userDatabase));\n      } else {\n        console.log(\"No users available\");\n      }\n    }).catch(error => {\n      console.log(\"Error in loading users\");\n    });\n  };\n};\n\nconst updateOnboarding = complete => ({\n  type: COMPLETE_ONBOARDING,\n  payload: {\n    user: {\n      isNewUser: complete\n    }\n  }\n});\n\nexport const completeOnboarding = (complete, userId) => {\n  return dispatch => {\n    database.collection(\"users\").doc(userId).update({\n      isNewUser: complete\n    }).then(() => {\n      dispatch(updateOnboarding(complete));\n    }).catch(error => {\n      console.log(\"Could not update user onboarding status:\", error);\n    });\n  };\n};\nexport const addReply = (reply, postId) => {\n  return dispatch => {\n    database.collection(\"posts\").doc(postId).update({\n      replies: firebase.firestore.FieldValue.arrayUnion(reply)\n    }).then(() => {\n      dispatch(updateReply(postId, reply));\n    }).catch(error => {\n      console.log(\"Could not add the reply.\", error);\n    });\n  };\n};\nexport const addReacts = (reacts, postId) => {\n  return dispatch => {\n    database.collection(\"posts\").doc(postId).update({\n      reacts: reacts\n    }).then(() => {\n      dispatch(updateReacts(postId, reacts));\n    }).catch(error => {\n      console.log(\"Could not add the reply.\", error);\n    });\n  };\n};\n\nasync function uploadPic() {\n  return new Promise(function (resolve, reject) {\n    var a = 0;\n    var b = 1;\n    a = a + b;\n    a = 5; // may be a heavy db call or http request?\n\n    resolve(picUrl); // successfully fill promise\n  });\n}\n\nasync function upload() {\n  var picUrl = await uploadPic();\n}\n\nlet d = new Date();\nexport const addPost = (caption, pictureUrl, tags, username) => {\n  return dispatch => {\n    const database = firebase.firestore();\n    var storage = firebase.storage();\n    var storageRef = storage.ref();\n    var imagesRef = storageRef.child('images');\n    var postImagesRef = imagesRef.child(pictureUrl.name);\n    postImagesRef.put(pictureUrl);\n    let picUrl = upload;\n    postImagesRef.getDownloadURL().then(url => {\n      console.log(\"url: \", url);\n      picUrl = url;\n    });\n    console.log(\"picture url here:\", picUrl);\n    database.collection(\"posts\").add({\n      caption: caption,\n      datePosted: `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()}`,\n      pictureUrl: picUrl,\n      tags: tags,\n      username: username,\n      reacts: {\n        heart: 0,\n        laugh: 0,\n        cry: 0,\n        angry: 0\n      },\n      replies: []\n    }).then(() => {\n      console.log(\"Added new post\");\n    }).catch(error => {\n      console.log(\"Could not add the new post: \", error);\n    });\n  };\n};\nexport const connectToChat = username => {\n  console.log(\"here\");\n  return dispatch => joinChat(username);\n}; // Replaces the direct call to sendMessage in Form\n\nexport const sendToChat = msg => {\n  return dispatch => sendMessage(msg);\n};\nexport const isConnected = () => ({\n  type: CONNECTED\n});\nexport const newMessage = messages => ({\n  type: NEW_MESSAGE,\n  payload: {\n    messages\n  }\n});","map":{"version":3,"sources":["/Users/shebthebat/Documents/NEU/Sem 5/CS 7580/neuGram-webApp/src/redux/actions.js"],"names":["COMPLETE_ONBOARDING","STORE_POSTS","LOGIN_SUCCESS","INVALID_LOGIN","LOGIN_NETWORK_ERROR","LOGOUT","NEW_MESSAGE","CONNECTED","STORE_USERS","ADD_REPLY","UPDATE_REACTS","ADD_POST_PAGE","VIEW_POST","STORE_ONLINE_USERS","firebase","joinChat","sendMessage","database","firestore","loginSuccess","user","type","payload","completeOnboarding","isNewUser","loginFail","loginNetworkError","logout","addPostPage","viewPost","storePosts","posts","getPosts","dispatch","collection","get","then","querySnapshot","size","forEach","doc","id","caption","data","datePosted","pictureUrl","reacts","replies","tags","userId","username","console","log","catch","error","storeUsers","users","storeUsersOnline","onlineUsers","updateReply","postId","reply","updateReacts","getUsers","userDatabase","password","isPublic","profilePicture","friendsList","updateOnboarding","complete","update","addReply","FieldValue","arrayUnion","addReacts","uploadPic","Promise","resolve","reject","a","b","picUrl","upload","d","Date","addPost","storage","storageRef","ref","imagesRef","child","postImagesRef","name","put","getDownloadURL","url","add","getFullYear","getMonth","getDate","heart","laugh","cry","angry","connectToChat","sendToChat","msg","isConnected","newMessage","messages"],"mappings":"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","sourcesContent":["import { COMPLETE_ONBOARDING, STORE_POSTS, LOGIN_SUCCESS, INVALID_LOGIN, \n  LOGIN_NETWORK_ERROR, LOGOUT, NEW_MESSAGE, CONNECTED, STORE_USERS, ADD_REPLY, UPDATE_REACTS, ADD_POST_PAGE, VIEW_POST, STORE_ONLINE_USERS } from \"./actionConstants\";\n\nimport firebase from \"../data/fbConfig\";\n\nimport { joinChat, sendMessage } from \"../client\";\n\nconst database = firebase.firestore();\n\nexport const loginSuccess = user => ({\n    type: LOGIN_SUCCESS,\n    payload: {\n        user: user,\n        completeOnboarding: user.isNewUser\n    }\n});\n\nexport const loginFail = () => ({\n    type: INVALID_LOGIN\n});\n\nexport const loginNetworkError = () => ({\n    type: LOGIN_NETWORK_ERROR\n});\n\nexport const logout = () => ({\n    type: LOGOUT\n});\n\nexport const addPostPage = () => ({\n  type: ADD_POST_PAGE\n})\n\nexport const viewPost = () => ({\n  type: VIEW_POST\n})\n\nexport const storePosts = (posts) => ({\n    type: STORE_POSTS,\n    payload: {\n        posts: posts\n    }\n})\n\nexport const getPosts = () => {\n    return dispatch => {\n      \n      database.collection(\"posts\")\n        .get()\n        .then((querySnapshot) => {\n          if (querySnapshot.size > 0) {\n            const posts = {};\n            querySnapshot.forEach(doc => {\n              posts[doc.id] = {\n                caption:doc.data().caption,\n                datePosted:doc.data().datePosted,\n                pictureUrl:doc.data().pictureUrl,\n                reacts:doc.data().reacts,\n                replies:doc.data().replies,\n                tags:doc.data().tags,\n                userId:doc.data().userId,\n                username:doc.data().username\n              }\n            })\n            dispatch(storePosts(posts));\n          }\n          else {\n            console.log(\"No posts available\") \n          }\n        })\n        .catch(error => {\n          console.log(\"Error\")\n        });\n    }\n  };\n\nexport const storeUsers = (users) => {\n  return {\n    type: STORE_USERS,\n    payload: {\n        users: users\n    }\n  }\n};\n\nexport const storeUsersOnline = (users) => {\n  return {\n    type: STORE_ONLINE_USERS,\n    payload: {\n        onlineUsers: users\n    }\n  }\n}\n\nconst updateReply = (postId, reply) => ({\n  type: ADD_REPLY,\n  payload: {\n      postId: postId,\n      reply: reply\n  }\n})\n\nconst updateReacts = (postId, reacts) => ({\n  type: UPDATE_REACTS,\n  payload: {\n      postId: postId,\n      reacts: reacts\n  }\n})\n\nexport const getUsers = () => {\n  return dispatch => {\n    const database = firebase.firestore();\n    database.collection(\"users\")\n      .get()\n      .then((querySnapshot) => {\n        if (querySnapshot.size > 0) {\n          const userDatabase = {};\n          querySnapshot.forEach(doc => {\n            userDatabase[doc.id] = {\n              username:doc.data().username,\n              password:doc.data().password,\n              isNewUser:doc.data().isNewUser,\n              isPublic:doc.data().isPublic,\n              profilePicture:doc.data().profilePicture,\n              friendsList:doc.data().friendsList,\n              userId: doc.id\n            }\n          })\n          dispatch(storeUsers(userDatabase));\n        }\n        else {\n          console.log(\"No users available\") \n        }\n      })\n      .catch(error => {\n        console.log(\"Error in loading users\")\n      });\n      \n}};\n\nconst updateOnboarding = (complete) => ({\n  type: COMPLETE_ONBOARDING,\n  payload: {\n    user: {\n      isNewUser: complete\n    }\n  }\n})\n\nexport const completeOnboarding = (complete, userId) => {\n  return dispatch => {\n    database.collection(\"users\").doc(userId)\n      .update({\n        isNewUser: complete\n      })\n      .then(() => {\n        dispatch(updateOnboarding(complete));\n      })\n      .catch(error => {\n        console.log(\"Could not update user onboarding status:\", error);\n      })\n  }\n}\n\nexport const addReply = (reply, postId) => {\n  return dispatch => {\n    database.collection(\"posts\").doc(postId)\n      .update({\n        replies: firebase.firestore.FieldValue.arrayUnion(reply)\n      })\n      .then(() => {\n          dispatch(updateReply(postId, reply));\n      })\n      .catch(error => {\n        console.log(\"Could not add the reply.\",error);\n      })\n  }\n}\n\nexport const addReacts = (reacts, postId) => {\n  return dispatch => {\n    database.collection(\"posts\").doc(postId)\n      .update({\n        reacts: reacts\n      })\n      .then(() => {\n          dispatch(updateReacts(postId, reacts));\n      })\n      .catch(error => {\n        console.log(\"Could not add the reply.\",error);\n      })\n  }\n}\n\nasync function uploadPic() {\n  return new Promise(function(resolve, reject) {\n      var a = 0;\n      var b = 1;\n      a = a + b;\n      a = 5;\n\n      // may be a heavy db call or http request?\n      resolve(picUrl) // successfully fill promise\n  })\n}\n\nasync function upload() {\n  var picUrl = await uploadPic()\n}\n\nlet d = new Date();\nexport const addPost = (caption, pictureUrl, tags, username) => {\n  return dispatch => {\n    const database = firebase.firestore();\n\n    var storage = firebase.storage();\n    var storageRef = storage.ref();\n    var imagesRef = storageRef.child('images');\n    var postImagesRef = imagesRef.child(pictureUrl.name);\n    postImagesRef.put(pictureUrl)\n\n    \n    let picUrl = upload\n    \n    postImagesRef.getDownloadURL().then((url) => {\n      console.log(\"url: \", url)\n      picUrl = url\n    })\n\n    console.log(\"picture url here:\", picUrl)\n\n    database.collection(\"posts\")\n      .add({\n        caption: caption,\n        datePosted: `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`,\n        pictureUrl: picUrl,\n        tags: tags,\n        username: username,\n        reacts: {heart:0, laugh:0, cry:0, angry:0},\n        replies: [],\n      })\n      .then(() => {\n          console.log(\"Added new post\")\n      })\n      .catch(error => {\n        console.log(\"Could not add the new post: \", error);\n\n      })\n  }\n}\n\nexport const connectToChat = username => {\n    console.log(\"here\");\n    return dispatch => joinChat(username);\n    \n}\n\n// Replaces the direct call to sendMessage in Form\nexport const sendToChat = msg =>  {\n    return dispatch => sendMessage(msg);\n}\n\nexport const isConnected = () => ({type: CONNECTED})\n\nexport const newMessage = messages => ({\n    type: NEW_MESSAGE,\n    payload: {\n        messages\n    }\n})"]},"metadata":{},"sourceType":"module"}